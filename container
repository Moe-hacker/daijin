#!/data/data/com.termux/files/usr/bin/bash
###### Github@Moe-hacker ######
#æˆ‘èŒæ•…æˆ‘åœ¨ï¼ğŸ˜†
#â€¢.,Â¸,.â€¢*Â¯`â€¢.,Â¸,.â€¢....â•­â”â”â”â”â”â”â•®
#`â€¢.,Â¸,.â€¢*Â¯`â€¢.,Â¸,.â€¢*Â¯.|::::::::::: /\:__:/\
#`â€¢.,Â¸,.â€¢*Â¯`â€¢.,Â¸,.â€¢* <|:::::::::::(ï½¡ â—Ï‰â—ï½¡)
#`â€¢.,Â¸,.â€¢*Â¯`â€¢.,Â¸,.â€¢*  â•°ã—---ã—---ï¼ªï½¥ï¾Ÿ
#ç¼–ç¨‹ç¬¬ä¸€æ³•åˆ™:å¦‚æœä½ çš„ä»£ç ä¸çŸ¥é“ä¸ºå•¥èƒ½è·‘èµ·æ¥ï¼Œå°±åˆ«å†åŠ¨å®ƒäº†ğŸ˜
#å€Ÿé‰´äº†ä¸€éƒ¨åˆ†andraxå¯åŠ¨è„šæœ¬(https://gitlab.com/crk-mythical/andrax-hackers-platform-v5-2/arm/start_andrax)ï¼Œé‡‡ç”¨ç›¸åŒçš„è®¸å¯è¯ã€‚
#å˜é‡åè®¾ç½®ğŸ§ï¼š
#${CHROOT_IMG}:å®¹å™¨é•œåƒæ–‡ä»¶
#${CHROOT_DIR}:chrootå®¹å™¨ç»å¯¹è·¯å¾„æˆ–æŒ‚è½½ç‚¹
#${SELINUX}:[on/off], æ˜¯å¦å…³é—­selinux
#${HOSTNAME}:è®¾ç½®ä¸»æœºå
#${OUTPUT}:[on/off]æ˜¯å¦å¯ç”¨è¾“å‡º
#${SLEEP}:[on/off]æ˜¯å¦å¯ç”¨åœé¡¿
###### E-mail: shichengniu2@gmail.com ######
if [[ $1 = "umount" ]];then
    if [[ ! $(whoami) = "root" ]];then #åˆ¤æ–­ç”¨æˆ·ï¼Œå¦‚æœä¸æ˜¯rootç›´æ¥æŠ¥é”™å…³é—­
            echo -e '\033[31m[ERR] \033[35mPlease run the script with sudo\033[0m'
            exit
    else
        export $(cat /data/data/com.termux/files/usr/etc/container.conf) #åŠ è½½é…ç½®
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[33m[i]\033[34mUmounting system\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mUmounting \033[35m/dev\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        umount -lvf ${CHROOT_DIR}/dev >/dev/null 2>&1 #è§£é™¤/devçš„æŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mUmounting \033[35m/sys\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        umount -lvf ${CHROOT_DIR}/sys >/dev/null 2>&1 #è§£é™¤/sysçš„æŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mUmounting \033[35m/proc\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        umount -lvf ${CHROOT_DIR}/proc >/dev/null 2>&1 #è§£é™¤/procæŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mUmounting \033[35mchroot_dir\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        umount -lvf ${CHROOT_DIR} >/dev/null 2>&1 #è§£é™¤ç›®å½•è‡ªèº«æŒ‚è½½
        if [[ $SELINUX = "off" ]];then #åˆ¤æ–­SELinuxæ˜¯å¦ä¸ºå…³é—­çŠ¶æ€
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mEnabling \033[35mSELinux\033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            setenforce 1  >/dev/null 2>&1 #é‡å¯SELinux
        fi
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[33m[i]\033[34mAll done!\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
    fi
elif [[ $1 = "help" ]];then
    #ç®—æ˜¯ä¸€ä¸ªå°å½©è›‹ï¼Œä¹‹å‰åšçš„ï¼Œæ‹¼äº†å¥½é•¿æ—¶é—´
    echo -e '                                 \033[30m â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n                              â–ˆâ–ˆâ–ˆâ–ˆ                        â–ˆâ–ˆ\n                        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              â–ˆâ–ˆâ–ˆâ–ˆ\n                    â–ˆâ–ˆâ–ˆâ–ˆ                                        â–ˆâ–ˆâ–ˆâ–ˆ\n                â–ˆâ–ˆâ–ˆâ–ˆ                                                â–ˆâ–ˆ\n          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                            â–ˆâ–ˆ                        â–ˆâ–ˆ\n              â–ˆâ–ˆ              â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ                          â–ˆâ–ˆ\n            â–ˆâ–ˆ              â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ                â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆ\n            â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ          â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ            â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ\n          â–ˆâ–ˆ        â–ˆâ–ˆâ–ˆâ–ˆ                           â–ˆâ–ˆâ–ˆâ–ˆ         â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆ\n          â–ˆâ–ˆ        â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ          â–ˆâ–ˆ        â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\n        â–ˆâ–ˆ        â–ˆâ–ˆ      â–ˆâ–ˆ                â–ˆâ–ˆ          â–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ\n        â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ                    â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆ\n      â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ                                â–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆ\n            â–ˆâ–ˆ  â–ˆâ–ˆ                                        â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        â–ˆâ–ˆ\n            â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ\n            â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ          â–ˆâ–ˆ            â–ˆâ–ˆ          â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ\n            â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ\n            â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ                â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ\n          â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ\033[31mâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ\033[31mâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ                â–ˆâ–ˆ\033[31mâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ\033[31mâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ\n          â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ                â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n          â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ                â–ˆâ–ˆ\033[31mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ\033[30mâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n        â–ˆâ–ˆ      â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n      â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ                                          â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n    â–ˆâ–ˆ  â–ˆâ–ˆ    â–ˆâ–ˆ                                          â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n  â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ          â–ˆâ–ˆ                      â–ˆâ–ˆ      â–ˆâ–ˆ            â–ˆâ–ˆ\n  â–ˆâ–ˆ      â–ˆâ–ˆ    â–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆ          â–ˆâ–ˆ      â–ˆâ–ˆ              â–ˆâ–ˆ\n  â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ      â–ˆâ–ˆ              â–ˆâ–ˆ\nâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ        â–ˆâ–ˆ                â–ˆâ–ˆ\nâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                          â–ˆâ–ˆ\nâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              â–ˆâ–ˆ\n  â–ˆâ–ˆ        â–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â–ˆâ–ˆâ–ˆâ–ˆ                  â–ˆâ–ˆ\n  â–ˆâ–ˆ          â–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ    â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ          â–ˆâ–ˆ                    â–ˆâ–ˆ\n  â–ˆâ–ˆ            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                              â–ˆâ–ˆ          â–ˆâ–ˆ                    â–ˆâ–ˆ\n    â–ˆâ–ˆ              â–ˆâ–ˆ                            â–ˆâ–ˆ            â–ˆâ–ˆ                    â–ˆâ–ˆ\n      â–ˆâ–ˆ          â–ˆâ–ˆ                              â–ˆâ–ˆ          â–ˆâ–ˆâ–ˆâ–ˆ                  â–ˆâ–ˆ\n        â–ˆâ–ˆ        â–ˆâ–ˆ                              â–ˆâ–ˆ          â–ˆâ–ˆâ–ˆâ–ˆ                â–ˆâ–ˆ\n          â–ˆâ–ˆ      â–ˆâ–ˆ                                â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆ                â–ˆâ–ˆ\n            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                                              â–ˆâ–ˆ                â–ˆâ–ˆ\n                â–ˆâ–ˆ                                              â–ˆâ–ˆ                â–ˆâ–ˆ\033[0m'
    echo -e '\033[34mè„šæœ¬é…ç½®ï¼š\033[0m'
    echo -e '  \033[34mé…ç½®æ–‡ä»¶ä½äº\033[35m/data/data/com.termux/files/usr/etc/container.conf\033[0m'
    echo -e '  \033[32mCHROOT_IMG\033[35m=\033[34må®¹å™¨é•œåƒçš„ç»å¯¹è·¯å¾„ï¼Œå¦‚æœä¸ä½¿ç”¨é•œåƒæ–‡ä»¶å¯ä¸å¡«\033[0m'
    echo -e '  \033[32mCHROOT_DIR\033[35m=\033[34må®¹å™¨çš„ç»å¯¹è·¯å¾„(æˆ–æŒ‚è½½ç‚¹)\033[0m'
    echo -e '  \033[32mSELINUX\033[35m=\033[33m[on/off] \033[34mæ˜¯å¦å…³é—­\033[35mSELinux\033[34mï¼Œä¸å»ºè®®å…³é—­ï¼Œä¼šä½¿æ‰‹æœºå˜å¾—ä¸å®‰å…¨ï¼Œä½†æ˜¯ç”±äºå®‰å“ç³»ç»Ÿçš„è¯»å– é™åˆ¶ï¼Œåœ¨å®¹å™¨ä¸­æ™®é€šç”¨æˆ·å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ­¤æ—¶å¯é€šè¿‡å…³é—­\033[35mSELinux\033[34m(ä¸´æ—¶å…³é—­ï¼Œé‡å¯è¿˜åŸ)è§£å†³\033[0m'
    echo -e '  \033[32mHOSTNAME\033[35m=\033[34mä½ çš„ä¸»æœºå\033[0m'
    echo -e '  \033[32mOUTPUT\033[35m=\033[33m[on/off] \033[34mæ˜¯å¦å¯ç”¨è„šæœ¬ è¾“å‡º\033[0m'
    echo -e '  \033[32mSLEEP\033[35m=\033[33m[on/off] \033[34mæ˜¯å¦å¯ç”¨åœé¡¿ï¼Œå¦‚æœä½ å«Œè¿è¡Œå¤ªå¿«ï¼Œå¯ä»¥å¼€å¯æ­¤é€‰é¡¹ï¼Œæ¯æ¡è¾“å‡ºååœé¡¿0.3ç§’\033[0m'
    echo -e '  \033[34mç¤ºä¾‹ï¼š\033[0m'
    echo -e '  \033[32mCHROOT_IMG\033[35m=\033[33m/data/example.img \033[32mCHROOT_DIR\033[35m=\033[33m/data/example \033[32mSELINUX\033[35m=\033[33mon \033[32mHOSTNAME\033[35m=\033[33mMoe-hacker \033[32mOUTPUT\033[35m=\033[33mon\033[0m \033[32mSLEEP\033[35m=\033[33mon\033[0m'
    echo -e '  \033[34mä¸Šè¿°é…ç½®å³ï¼šå®¹å™¨é•œåƒä¸º\033[35m/data/example.img å®¹å™¨ç›®å½•ä¸º\033[35m/data/example \033[34må¯ç”¨\033[35mSELinux \033[34mä¸»æœºåä¸º\033[35mMoe-hacker \033[34må¯ç”¨è„šæœ¬è¾“å‡º\033[0m \033[34må¯ç”¨åœé¡¿\033[0m'
    echo -e '\033[34mè„šæœ¬ç”¨æ³•:\033[0m'
    echo -e '  \033[33mcontainer\033[34m:è¿è¡Œ\033[35mChroot\033[34må®¹å™¨\033[0m'
    echo -e '  \033[33mcontainer umount\033[34m:è§£é™¤ç³»ç»ŸæŒ‚è½½\033[0m'
else
    if [[ ! $(whoami) = "root" ]];then #åˆ¤æ–­ç”¨æˆ·ï¼Œå¦‚æœä¸æ˜¯rootç›´æ¥æŠ¥é”™å…³é—­
        echo -e '\033[31m[ERR] \033[35mPlease run the script with sudo\033[0m'
        exit
    else
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[33m[i]\033[34mDevice is rooted\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
    fi
    #åŠ è½½é…ç½®æ–‡ä»¶
    if [[ ! -e /data/data/com.termux/files/usr/etc/container.conf ]];then # åˆ¤æ–­é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
        echo -e '\033[31m[ERR] \033[35m/data/data/com.termux/files/usr/etc/container.conf \033[31mdoes not exist. See \033[33m container help \033[0m'
        exit
    elif [[ $(cat /data/data/com.termux/files/usr/etc/container.conf) = "" ]];then
        echo -e '\033[31m[ERR]Please edit \033[35m/data/data/com.termux/files/usr/etc/container.conf \033[31mSee \033[33m container help \033[0m'
    else
        export $(cat /data/data/com.termux/files/usr/etc/container.conf) #åŠ è½½é…ç½®
    fi
    if [[ ! -e ${CHROOT_DIR} ]];then #åˆ¤æ–­å®¹å™¨æ˜¯å¦å­˜åœ¨
            echo -e '\033[31m[ERR]\033[35mContainer directory does not exist. \033[0m'
            exit
    fi
    if [[ !${CHROOT_IMG} = "" ]] && [[ ! -e ${CHROOT_IMG} ]];then #å¦‚æœä½¿ç”¨å®¹å™¨é•œåƒï¼Œåˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨
            echo -e '\033[31m[ERR]\033[35mImage file does not exist. \033[0m'
            exit
    fi
    if [[ ${SELINUX} = "off" ]];then #åˆ¤æ–­æ˜¯å¦éœ€è¦å…³é—­selinux
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mDisabling \033[35mSELinux\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        setenforce 0 >/dev/null 2>&1 #å…³é—­SELinux [!]å±é™©æ“ä½œ
    fi
    if [[ ! ${HOSTNAME} = "" ]];then #åˆ¤æ–­ä¸»æœºåè®¾ç½®æ˜¯å¦ä¸ºç©ºå€¼
        if [[ ! $(hostname) = ${HOSTNAME} ]];then
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mSetting \033[35mhostname\033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            hostname ${HOSTNAME} >/dev/null 2>&1 #è®¾ç½®ä¸»æœºå
        fi
        if [[ $(cat ${CHROOT_DIR}/etc/hosts|grep ${HOSTNAME}) = "" ]];then
            echo 127.0.0.1 ${HOSTNAME} >> ${CHROOT_DIR}/etc/hosts #ä¿®å¤sudoæŠ¥é”™æ— æ³•è§£æä¸»æœº
        fi
    fi
#####ä¸‹é¢è¿™æ®µå€Ÿé‰´äº†andraxçš„å¯åŠ¨è„šæœ¬#####
#####åŠ å…¥æŠŠç³»ç»Ÿå®‰è£…åœ¨.imgé•œåƒæ–‡ä»¶çš„é€‰é¡¹#####
#####åŠ å…¥ä¸€äº›åˆ¤æ–­ï¼Œä¿®å¤äº†sudoæ— æ³•ä½¿ç”¨(æœªå®Œå…¨è§£å†³)ï¼Œä¿®å¤äº†pacmanæ— æ³•åˆ†ææŒ‚è½½ç‚¹######
#####åŠ å…¥æ²¡å•¥ç”¨çš„è¾“å‡ºå’Œåœé¡¿######
    #åˆ›å»ºä¸€äº›ç”±äºandroidå’Œæ™®é€šlinuxä¹‹é—´çš„å·®å¼‚è€Œä¸å­˜åœ¨çš„æ–‡ä»¶
    if [[ ! -e /dev/fd ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mLinking\033[35m/proc/self/fd \033[34mto \033[35m/dev/fd\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        ln -s /proc/self/fd /dev/ >/dev/null 2>&1
    fi
    if [[ ! -e /dev/stdin ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mLinking\033[35m/proc/self/fd/0 \033[34mto \033[35m/dev/stdin\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        ln -s /proc/self/fd/0 /dev/stdin  >/dev/null 2>&1
    fi
    if [[ ! -e /dev/stdout ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mLinking\033[35m/proc/self/fd/1 \033[34mto \033[35m/dev/stdout\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        ln -s /proc/self/fd/1 /dev/stdout >/dev/null 2>&1
    fi
    if [[ ! -e /dev/stderr ]] ;then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mLinking\033[35m/proc/self/fd/2 \033[34mto \033[35m/dev/stderr\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        ln -s /proc/self/fd/2 /dev/stderr >/dev/null 2>&1
    fi
    if [[ ! -e /dev/tty0 ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mLinking \033[35m/dev/null \033[34mto \033[35m/dev/tty0\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        ln -s /dev/null /dev/tty0 >/dev/null 2>&1
    fi
    if [[ ! -e /dev/net/tun ]];then
        if [[ ! -d /dev/net ]];then
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mCreating directory \033[35m/dev/net\033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            mkdir -p /dev/net >/dev/null 2>&1
        fi
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mCreating virtual device file \033[35m/dev/net/tun\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mknod /dev/net/tun c 10 200  >/dev/null 2>&1
    fi
    #æŒ‚è½½ç³»ç»Ÿ
    if [[ $(mount|grep ${CHROOT_DIR}) =  "" ]];then #åˆ¤æ–­å®¹å™¨è‡ªèº«æ˜¯å¦è¢«æŒ‚è½½ï¼Œç”±äºå®¹å™¨è‡ªèº«åœ¨è¿è¡Œè„šæœ¬æ—¶ç¬¬ä¸€ä¸ªè¢«æŒ‚è½½ï¼Œæ•…é‡‡ç”¨åˆ¤æ–­æŒ‚è½½ç‚¹æ˜¯å¦ä¸ºç©ºçš„æ–¹æ³•
        if [[ ${CHROOT_IMG} = "" ]];then
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35mchroot_dir\033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            mount --bind ${CHROOT_DIR} ${CHROOT_DIR} >/dev/null 2>&1 #å°†å®¹å™¨ç›®å½•æŒ‚è½½åˆ°è‡ªèº«ï¼Œè§£å†³pacmanæ— æ³•ä½¿ç”¨
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mRemounting \033[35m/data\033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            mount -o remount,suid /data  >/dev/null 2>&1 #å°†dataåˆ†åŒºé‡æ–°æŒ‚è½½ï¼Œå¯ç”¨suid,è§£å†³sudoç”±äºnosuidæŒ‚è½½æ— æ³•ä½¿ç”¨é—®é¢˜(è§£å†³äº†ï¼Œä½†æ²¡å®Œå…¨è§£å†³ï¼Œå¯¹äºä¸€äº›é‡‡ç”¨vabåˆ†åŒºçš„æ‰‹æœºå¯èƒ½æ— æ•ˆï¼Œæ¯”å¦‚æˆ‘çš„k40proå°±æ˜¯vabåˆ†åŒº)
        else
            [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting image file \033[0m'
            [[ ${SLEEP} = "off" ]] || sleep 0.3s
            loop=$(losetup -f)
            losetup  ${loop} ${CHROOT_IMG}  >/dev/null 2>&1
            mount  ${loop} ${CHROOT_DIR}  >/dev/null 2>&1
        fi
    fi
    #åˆ›å»ºrootfsä¸­å¯èƒ½ä¸å­˜åœ¨çš„æ–‡ä»¶,æš‚æ—¶ä¸åŠ è¾“å‡º
    if [[ ! -e ${CHROOT_DIR}/dev || ! -e ${CHROOT_DIR}/proc || ! -e ${CHROOT_DIR}/sys ]]; then
		[[ -e ${CHROOT_DIR}/dev ]] || mkdir ${CHROOT_DIR}/dev
		[[ -e ${CHROOT_DIR}/proc ]] || mkdir ${CHROOT_DIR}/proc
		[[ -e ${CHROOT_DIR}/sys ]] || mkdir ${CHROOT_DIR}/sys 
	fi
    if [[ $(mount|grep ${CHROOT_DIR}|grep /proc) =  "" ]];then #åˆ¤æ–­/procæ˜¯ å¦è¢«æŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35m/proc\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mount --bind /proc ${CHROOT_DIR}/proc/ >/dev/null 2>&1
    fi
    if [[ ! -e ${CHROOT_DIR}/dev/block ]];then #åˆ¤æ–­/devæ˜¯å¦è¢«æŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35m/dev\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mount --bind /dev ${CHROOT_DIR}/dev/ >/dev/null 2>&1
    fi
    if [[ $(mount|grep ${CHROOT_DIR}|grep /sys) =  "" ]];then #åˆ¤æ–­/sysæ˜¯å¦ è¢«æŒ‚è½½
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35m/sys\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mount --bind /sys ${CHROOT_DIR}/sys/ >/dev/null 2>&1
    fi
    #æŒ‚è½½ä¸€äº›æ–‡ä»¶åˆ°ç³»ç»Ÿï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ä¸ºå•¥ï¼Œè²Œä¼¼åŸé¡¹ç›®å°±è¿™æ ·å†™çš„
    if [[ ! -e /dev/shm ]] || [[ ! -e ${CHROOT_DIR}/dev/shm ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mCreating directory \033[35m/dev/shm\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mkdir -p /dev/shm ${CHROOT_DIR}/dev/shm >/dev/null 2>&1 #åˆ›å»º/dev/shm
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35mtmpfs\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mount -o rw,nosuid,nodev,mode=1777 -t tmpfs tmpfs /dev/shm >/dev/null 2>&1 #æŒ‚è½½tmpfs
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35m/dev/shm\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mount --bind /dev/shm ${CHROOT_DIR}/dev/shm >/dev/null 2>&1 #æŒ‚è½½/dev/shm
    fi
    #ç”±äºæœ¬äººæŠ€æœ¯å¤ªèœä¸ä¼šåˆ¤æ–­/dev/nullæƒé™ï¼Œç›´æ¥åŠ åˆ°/dev/ptsçš„åˆ¤æ–­é‡Œé¢ï¼Œåæ­£åœ¨umountå‰åªæ‰§è¡Œä¸€æ¬¡
    if  [[ ! -e ${CHROOT_DIR}/dev/pts ]];then
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mMounting \033[35m/dev/pts\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        mkdir ${CHROOT_DIR}/dev/pts
        mount --bind /dev/pts ${CHROOT_DIR}/dev/pts >/dev/null 2>&1
        [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mChanging mode of \033[35m/dev/null \033[34mto \033[32m666\033[0m'
        [[ ${SLEEP} = "off" ]] || sleep 0.3s
        chmod 666 /dev/null >/dev/null 2>&1
    fi
    [[ ${OUTPUT} = "off" ]] || echo -e '\033[32m[*]\033[34mUnsetting \033[35menvironment variables\033[0m'
    [[ ${SLEEP} = "off" ]] || sleep 0.3s
    [[ ${OUTPUT} = "off" ]] || echo -e '\033[33m[i]\033[34mRunning chroot\033[0m'
    [[ ${SLEEP} = "off" ]] || sleep 0.3s
    unset TMP TEMP TMPDIR LD_PRELOAD LD_DEBUG ZPFX ZSH_CACHE PATH #åˆ é™¤éƒ¨åˆ†ç¯å¢ƒå˜é‡
    /bin/chroot ${CHROOT_DIR} /bin/su - root
fi