#!/data/data/com.termux/files/usr/bin/bash
#########用于容器安装#########
clear
echo -e "\033[31mTERMUX-CONTAINER\033[0m"
echo -e "\033[31mBY MOE-HACKER\033[0m"
echo -e "\033[31mGPL-V3 LICENSE\033[0m"
echo -e "\033[31m//\033[0m"
echo -e ""
echo -e "\033[41;37mCONFIGURE...                                    \033[0m"
echo -e ""
echo -e "\033[31m//\033[0m"
echo -e ""
sleep 0.3s
echo -e "\033[31mNO WARRANTY\033[0m"
echo -e "\033[31mKERNEL $(uname --kernel-release)\033[0m"
echo -e "\033[31mTIME $(date|awk '{print $4}')\033[0m"
echo -e "\033[31mANDROID $(neofetch |grep Android|awk '{print $3}')\033[0m"
sleep 1s
echo -e ""
echo -e "\033[31m                o            o\033[0m"
echo -e "\033[31m                 o          o\033[0m"
echo -e "\033[31m                 +hydNNNNdyh+\033[0m"
echo -e "\033[31m               +mMMMMMMMMMMMMm+\033[0m"
echo -e "\033[31m              dMM::NMMMMMMN::MMd \033[0m"
echo -e "\033[31m             hMMMMMMMMMMMMMMMMMMh\033[0m"
echo -e "\033[31m        ╔═║  ╔═   ╔═   ╔═║  ╔═║  ║  ╔═"
echo -e "\033[31m        ╔═║  ║ ║  ║ ║  ╔╔╝  ║ ║  ║  ║ ║"
echo -e "\033[31m        ╝ ╝  ╝ ╝  ══   ╝ ╝  ══╝  ╝  ══"
echo -e ""
echo -e "\033[31m1001011 1100101 1100101 1110000 1100111 0100000\033[0m"
echo -e "\033[31m1101101 1101111 1100101 1011000 1101011 1000011\033[0m"
echo -e "\033[31m1100101 1100101 1110000 1000000 1100011 1101110\033[0m"
echo -e "\033[31m1101111 1101111 1101100 1011000 1101011 1101011\033[0m"
echo -e "\033[31m1100101 1100101 1110000 1000000 1101000 1100110\033[0m"
echo -e "\033[31m1100001 1100011 1101011 1101000 1101110 1000000\033[0m"
echo -e "\033[31m1100111 1011001 1101011 1100101 1100101 1100110\033[0m"
echo -e "\033[31m1110000 1000001 1100110 1101001 1111001 1000010\033[0m"
echo -e "\033[31m1101001 1101110 1100111 1011100 0001010 1101011\033[0m"
echo -e "\033[31m1011011 1011011 1011010 1011010 1010100 1101110\033[0m"
echo -e "\033[31m1100001 1101100 1101011 1000000 1101001 1000000\033[0m"
echo -e "\033[31m1110011 1000000 1100011 1101000 1100101 1011001\033[0m"
echo -e "\033[31m1100001 1110000 1011000 1110011 1101000 1101011\033[0m"
echo -e "\033[31m1101111 1110111 1000000 1101101 1100101 1100101\033[0m"
echo -e "\033[31m1000001 1110100 1101000 1100101 0100000 1100110\033[0m"
echo -e "\033[31m1100011 1101111 1100100 1100101 0101110 1011000\033[0m"
echo -e "\033[31m1101001 1101110 1100111 1011100 0001010 1000000\033[0m"
echo -e "\033[31m1100001 1100011 1101011 1101000 1101110 1011000\033[0m"
echo -e ""
echo -e "\033[31m//\033[0m"
echo -e "\033[31mNEVER SETTLE\033[0m"
echo -e "\033[31m//"
echo -e ""
read -p "请输入容器的绝对路径(或挂载点):" CHROOT_DIR
read -p "请输入镜像文件绝对路径(一般为/data/xxx.img或/sdcard/xxx.img)，如果不使用镜像文件请留空:" CHROOT_IMG
read -p "请输入镜像文件大小(纯数字，单位为Gb)，如果不使用镜像文件请留空:" SIZE
read -p "请输入rootfs的下载链接:" URL
read -p "是否关闭SELinux?[y/n]:" SELINUX
read -p "请输入主机名(hostname):" HOSTNAME
read -p "是否启用输出?[y/n]:" OUTPUT
read -p "每条输出后是否停顿?[y/n]:" SLEEP
echo -e "正在下载rootfs………………………………"
sleep 1s
cd ~
wget ${URL}
sudo mkdir ${CHROOT_DIR}
if [[ ! ${CHROOT_IMG} = "" ]];then
  echo -e "正在创建镜像文件………………………………"
  sudo dd if=/dev/zero of=${CHROOT_IMG} bs=1G count=${SIZE}
  sudo mkfs.ext4 ${CHROOT_IMG}
  echo -e "正在挂载镜像………………………………"
  sleep 1s
  LOOP=$(sudo losetup -f)
  sudo losetup  ${LOOP} ${CHROOT_IMG}  >/dev/null 2>&1
  sudo mount ${LOOP} ${CHROOT_DIR}  >/dev/null 2>&1
fi
echo -e "正在解压rootfs………………………………"
sleep 1s
sudo tar -xvf rootfs.tar.xz -C ${CHROOT_DIR}
echo -e "正在写入配置………………………………\033[0m"
sleep 1s
echo CHROOT_DIR=${CHROOT_DIR} >> /data/data/com.termux/files/usr/etc/container.conf
echo CHROOT_IMG=${CHROOT_IMG} >> /data/data/com.termux/files/usr/etc/container.conf
echo SELinux=${SELINUX} >> /data/data/com.termux/files/usr/etc/container.conf
echo OUTPUT=${OUTPUT} >> /data/data/com.termux/files/usr/etc/container.conf
echo SLEEP=${SLEEP} >> /data/data/com.termux/files/usr/etc/container.conf
echo HOSTNAME=${HOSTNAME} >> /data/data/com.termux/files/usr/etc/container.conf
echo -e "\033[31m正在删除已下载的rootfs………………………………\033[0m"
sleep 1s
rm ~/rootfs.tar.xz
