#!/data/data/com.termux/files/usr/bin/bash
#########用于解除系统文件挂载#########
export $(cat /data/data/com.termux/files/usr/etc/container.conf) >> /dev/null
export $(cat /data/data/com.termux/files/usr/etc/container.conf.d/container-${CONTAINER}.conf) >> /dev/null
clear
echo -e "\033[38;5;123m"
echo -e "//"
echo -e ""
i1=$(($(stty size|awk '{print $2}')))
let i1=$(($i1))
i1=$(($i1-19))
echo -e "\033[46;37mCONTAINER_UNMOUNT$(yes " "|sed $i1'q'|tr -d '\n')\033[0m"
echo -e "\033[38;5;123m"
echo -e "//"
echo -e ""
[[ ${OUTPUT} = "n" ]] ||sleep 0.1s
[[ ${OUTPUT} = "n" ]] || echo -e "[START] UNMOUNT /dev"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
umount -lvf ${CHROOT_DIR}/dev >/dev/null 2>&1 #解除/dev的挂载
[[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] UNMOUNT /dev"
[[ ${OUTPUT} = "n" ]] || echo -e "[START] UNMOUNT /sys"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
umount -lvf ${CHROOT_DIR}/sys >/dev/null 2>&1 #解除/sys的挂载
[[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] UNMOUNT /sys"
[[ ${OUTPUT} = "n" ]] || echo -e "[START] UNMOUNT /proc"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
umount -lvf ${CHROOT_DIR}/proc >/dev/null 2>&1 #解除/proc挂载
[[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] UNMOUNT /proc"
[[ ${OUTPUT} = "n" ]] || echo -e "[START] UNMOUNT /sdcard"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
umount ${CHROOT_DIR}/sdcard >/dev/null 2>&1 #解除/sdcard的挂载
[[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] UNMOUNT /sdcard"
[[ ${OUTPUT} = "n" ]] || echo -e "[START] UNMOUNT ${CHROOT_DIR}"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
umount -lvf ${CHROOT_DIR} >/dev/null 2>&1 #解除目录自身挂载
losetup -d ${CHROOT_IMG} >/dev/null 2>&1 #解除img镜像与虚拟设备的关联
[[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] UNMOUNT ${CHROOT_DIR}"
if [[ $SELINUX = "y" ]];then #判断SELINUX是否为关闭状态
  [[ ${OUTPUT} = "n" ]] || echo -e "[START] ENABLE SELINUX"
  [[ ${OUTPUT} = "n" ]] || sleep 0.3s
  setenforce 1  >/dev/null 2>&1 #重启SELINUX
  [[ ${OUTPUT} = "n" ]] || echo -e "[DONE ] ENABLE SELINUX"
fi
hostname localhost  >/dev/null 2>&1
[[ ${OUTPUT} = "n" ]] || echo -e "[INFO ] DONE"
[[ ${OUTPUT} = "n" ]] || sleep 0.3s
#   │  │   ╔══╝╔══║╔══╝
# ── ── ── ║   ║  ║║
#   │  │   ╔══╝║  ║╔══╝
# ── ── ── ║   ║  ║║
#   │  │   ═══╝═══╝╝
